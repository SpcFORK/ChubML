import{a as w}from"./chunk-BDFFKWZU.mjs";import{a as m}from"./chunk-SBYLR2US.mjs";import{a as c,b as p}from"./chunk-5FZSLDQI.mjs";import{a as y}from"./chunk-CBHQQSGR.mjs";import{a as d}from"./chunk-7D7K5WQR.mjs";import"../global";var C=class u extends y{static ChubML=u;ChubML=u;static#o=new w("chubstart");static#t=new w("chubinjected");static{c.lastChub||="",c.cbMode||="",c.chubLocation||="",window.onload=()=>{this.#o.detail=this,this.#o.activate()}}#l=t=>({tag:"",id:"",class:"",content:"",data:"",style:"",attr:"",indent:0,[Symbol.unscopables]:{_:t||null}});#X(t){return Reflect.get(t,Symbol.unscopables)}#n=()=>({str:0,tmp:0});#g=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];get doc(){return document}#c(t,e){typeof t=="string"?this.body.innerHTML=t:this.body.appendChild(t)}get body(){return document.body}set body(t){this.#c(t,this.body)}get head(){return document.head}set head(t){this.#c(t,this.head)}get html(){return document.documentElement}get title(){return document.title}set title(t){document.title=t}get chubLocation(){return c.chubLocation}set chubLocation(t){c.chubLocation=t}get chubDev(){return c.chubDev}set chubDev(t){c.chubDev=t}#s(t,e=""){return t||e}#e(t){return t?t+" ":""}s=y;styled={};#i=()=>this.s.Rexps;#p(t){let e=this.#i;return t.replace(e().lineWithComment,"").replace(e().formatspace2,`
`).replace(e().formatspace1,`
`)}#w(t){let e=t.split(/;/),r=[];for(let n of e)r.push({c:n.trim(),i:n.search(/\S/)});return r}#y(t){let e=[],r=[];for(let n of t){let s=n.i,i={c:n.c,i:s,children:[]};for(;r.length>0&&s<=r[r.length-1].i;)r.pop();r.length>0?r[r.length-1].children.push(i):e.push(i),r.push(Object.assign(i))}return e}#C(t){let e=this.#i,r=t[1],n=r.includes("src="),s=r.includes(`"execafter";
`);var i=!0;let a=async o=>{let b=await(await fetch(o)).text();try{let h=document.createElement("script");h.type="text/javascript",h.text=b,document.body.appendChild(h)}catch(h){console.log(h,this.s.errorList.scripterror)}};if(n&&t){let o=r.match(/src="(.*)"/);o&&(a(o[1]),i=!1)}if(t!==null&&i)try{p(r)}catch(o){console.error(o,this.s.errorList.scripterror)}}async#m(t,e){window?.location?.origin&&(e=`${e}`.includes("{{ORIG}}")?e.replace("{{ORIG}}",window.location.origin):e),t.tag=t.tag?t.tag:"fetcherBlock",t.data=`${this.#e(t.data)}data-fetchw="${e}" data-instance="${new Date().getTime()}"`;let n=await(await fetch(await this.findFile([e]))||{text:()=>e}).text();if(t.content=`${n||""}`,window?.location?.origin){let s=this.$(`[${t.data.split(" ").join("][")}]`);s&&(s.innerHTML=t.content.replace(/\n/g,`
</br>
`))}return e}#L(t,e){try{var r=new Function(e).bind(t)(this)}catch(n){return console.error(n,this.s.errorList.scripterror)}this.chubDev&&console.log("AtEval: ",r),r&&this.#a(t,r)}#a(t,e){let r=this.#s(e);t.content+=r,this.chubDev&&console.log("AtPutCont: ",e)}#E(t,e){let r=this.#s(e),n=p(r);if(!n)throw new d("CowErr","No Call: "+r);if(typeof n!="function")throw new d("CowErr","Not a function: "+r);let s=n(t);s&&this.#a(t,s),this.chubDev&&console.log("Call: ",s)}#k(t,e){let r=this.#s(e),n=this.$(r);if(!n)throw new d("CowErr","No Template: "+r);let s=n.innerHTML;t.content+=s,this.chubDev&&console.log("AtFrom: ",s)}#S(t,e){if(typeof e!="string")return;this.chubDev&&console.log("using @: ",`${e}`.slice(1).split(/[=>]/));let r=e.slice(1);function n(i){return r.slice(i+1)}function s(i){return r.startsWith(i)}switch(!0){case s("fetchw"):this.#m(t,n(6));break;case s("eval"):this.#L(t,n(4));break;case s(":"):this.#a(t,n(0));break;case s("call"):this.#E(t,n(4));break;case s("from"):this.#k(t,n(4));break;case s(""):default:console.log("no valid @ found...?",e)}return e}#h(t,e,r,n=1){let s=r.slice(n);t[e]=this.#e(t[e].toString())+s}#T(t,e){this.#h(t,"class",e)}#v(t,e){this.#h(t,"id",e)}#$(t,e){this.#u(t,e,"data",!0)}#N(t,e){this.#u(t,e,"attr",!1)}#u(t,e,r,n){let s=this.attrSyn(e);if(!s)return;let i=s[0].slice(1),a=s[1],o=`${i}="${a}"`;n&&(o=`data-${o}`),t[r]=this.#e(t[r])+o}#x(t,e,r){switch(t[0]){case"#":this.#v(e,t);break;case".":this.#T(e,t);break;case"$":this.#$(e,t);break;case"%":this.#N(e,t);break;case"@":t=this.#S(e,t);break;default:e.tag=this.#e(e.tag)+t}return t}#d=(t,e)=>e.forEach((r,n)=>{r=this.#x(r,t,n)});#f(t,e,r,n=""){let s=this.#i,i="  ",a=t.c,o=a.search(s().betweenQuote),l=a.search(s().betweenCol),b=a.match(s().script),h=this.#l(t),f=this.#l(t);if(b!==null&&this.#C(s().script.exec(a)),o!==-1){let g=a.split(s().betweenCol),k=a.split(s().betweenQuote)[1];if(l==null)f=h;else{var E=g[1]||"";this.#d(f,E.split(" "))}r.str++,f.content=k}else this.#d(f,a.split(" "));return t.o=f,t.i=i.repeat(e),t.children&&t.children.forEach(g=>this.#f(g,e+1,r,n)),[t,r]}#D(t,e=this.#n()){let{o:r}=t,n=!1;if(!r)throw new d("No CIL object found!");switch(r.tag){}return{isTemplate:n}}#R(t,e){for(let r in this.styled)if(this.styled[r]===!0&&this.styled.styles[r]){let n=e?"":`
`;t=t.replace("<head>","<head>"+n+this.styled.styles[r]),this.styled[r]="has"}return t}#I(t,e){return t.includes("head")&&(t=this.#R(t,e)),t}#A(t,e){let r=s=>!!s,n=s=>t+=s;return r(e.class)&&n(` class="${e.class}"`),r(e.id)&&n(` id="${e.id}"`),r(e.style)&&n(` style="${e.style}"`),r(e.data)&&n(` ${e.data}`),r(e.attr)&&n(` ${e.attr}`),t}#P(t,e,r,n,s,i){let a=i?"":`
`;t=a+`${i?"":e.i}<${r.tag}`,t=this.#A(t,r),n>0&&(s=!0);let o=">"+a;return s&&(t+=" /"),t+=o,{html:t,shorter:s}}#F(t,e,r,n){let s=n?"":t.i;switch(t.c[0]){case'"':e+=s+t.c.slice(1,t.c.length-1);break;default:e+=s+this.#b(t,r,n)}return e}#H(t,e,r,n){for(let s of t.children)e=this.#F(s,e,r,n);return e}#O(t,e,r,n,s){let i=s?"":`
`;return t+=i,e||(t+=`${s?"":r.i}</${n.tag}>${i}`),t.includes("<>")&&(t=t.replace("<>","").replace("</>","")),t}#M(t,e,r){let n=r?"":t.i+"  ";return t.o?.content&&(e+=n+t.o.content),e}#b(t,e=this.#n(),r=!1){let n=t.o;if(!n)throw new d("No CIL object found!");let s=!1,i=this.arrMatch(n.tag,this.#g),a=i.count,o=i.list,l="",{isTemplate:b}=this.#D(t,e);return{html:l,shorter:s}=this.#P(l,t,n,a,s,r),l=this.#M(t,l,r),l=this.#H(t,l,e,r),l=this.#O(l,s,t,n,r),l=this.#I(l,r),l}#q(t,e,r=""){let n=this.#n();return[t,n]=this.#f(t,0,n,r),this.#b(t,n,e)}parse(t,e){let r=this.#p(t),n=this.#w(r),s=this.#y(n);return this.#q(s[0],e)}async findFile(t){for(let r of t){try{var e=await fetch(r)}catch(n){console.error(`Error fetching file from '${r}':`,n)}if(e?.ok)return r}return null}ChubRep(t,e="<!DOCTYPE html>"){t=this.parse(t,!0),document.open(),document.write(e+`
`+t),document.close()}injectChub(t){var e=this.parse(t,!0);this.chubDev==!0&&console.log(e);let r=this.chubLocation||"chub",n=this.$(r);n?n.innerHTML=e:r="body",u.#t.detail=n,u.#t.activate()}Router=class{__env__=m();constructor(){switch(this.__env__){case"Node":break;case"Browser":break}}};CHUBfax(t,e=" "){let r=t||"";return r=r.replaceAll("=","|e").replaceAll(";","|col").replaceAll('"',"|qw").replaceAll(e,"|"),r}attrSyn(t){if(`${t}`.match(/=/gm)?.length>1)throw this.s.errorList.eqspl3;return t.replace("="," spcfork.Equals.Token ").replace("\\|"," spcfork.Pipe.Token ").replace(/\|e/gm,"=").replace(/\|col/gm,";").replace(/\|qw/gm,'"').replace(/\|/gm," ").replace(" spcfork.Pipe.Token ","|").split(" spcfork.Equals.Token ")}async CHUBWFetch(t){let e=await fetch(t);if(!e?.ok)throw new Error(`HTTP error! Status: ${e.status}`);let r=await e.text();return this.HTMLToChub(r)}getURLbit(){var t=window.location.href,e=t.split("/"),r=e[e.length-1];return r}CHUBsanitize(t){var e=document.createElement("div");e.innerText=t;var r=e.innerHTML;return r}DupeCollection={};CHUBduper(t="p;"){this.DupeCollection||(this.DupeCollection={}),this.DupeCollection[t]!==void 0?this.DupeCollection[t]+=1:this.DupeCollection[t]=0;let e;if(t.includes(";")){let n=t.split(";");n[0]+=` #${this.DupeCollection[t]}`,e=n.join("")}else e=t+";";let r={editedDupe:e,D:this.DupeCollection,s:()=>JSON.stringify(this.DupeCollection),c:()=>JSON.parse(r.s())};return r}CHUBstrprep(t){return t.replace(/[.*+?^${}()|[\]\\"';:]/g,"\\$&").replace(/[;]/g,"|col")}CHUBunmess(t){let r=t.replace(/\\\"/g,'"').replace(/\\\|col/g,",");return[r,JSON.parse(r)]}MLTextToNodes(t,e="text/html"){return new DOMParser().parseFromString(t,e)}Chubify(t){let e=this.parse(t,!0);return this.MLTextToNodes(e,"text/html")}HTMLToChub=(t,e="")=>{t instanceof Element&&(t=t.outerHTML);let r=this.MLTextToNodes(t,"text/html");return this.getChubML(r.documentElement,"",e)};getChubML=(t,e="",r="")=>{let n="";if(n+=`${e}${t.nodeName.toLowerCase()}`,t.attributes.length>0){let s=Array.from(t.attributes);n=this.#j(s,n)}return t.childNodes.length>0?n=this.#B(n,t,e,r):n+=`;
`,n};#U(t,e){if(!t.textContent)return"";let r=t.textContent.trim();return r!=""?`${e}  "${r}";
`:""}#B(t,e,r,n){t+=`;
`;let s=Array.from(e.childNodes);for(let i of s)switch(i.nodeType){case Node.TEXT_NODE:t+=this.#U(i,r);break;case Node.ELEMENT_NODE:t+=this.getChubML(i,r+"  ",n);break}return t+=`${r}${n}
`,t}#j(t,e){let r=n=>this.CHUBfax(n.value);for(let n of t)switch(n.name.toLowerCase()){case"class":e+=` .${r(n)}`;break;case"id":e+=` #${r(n)}`;default:e+=` %${n.name}=${r(n)}`}return e}aliasIndexes=["beam.lmc","beam.chub","index.lmc","index.chub"];async#r(t,e={}){let r=await fetch(t,{method:"HEAD",...e});return[r.ok,r]}async#_(t){let[e,r]=await this.#r(t);if(!e)throw new Error("File not found!");return{req:await fetch(t),okRes:r}}async#G(t){for(let e of t){let[r,n]=await this.#r(e);if(r)return e}return null}#W=(t,e)=>new Promise(async(r,n)=>{try{await t(e,r)}catch(s){n(s)}});async#J(t){let e=[],r=new AbortController,n=async(i,a)=>{if(r.signal.aborted)throw new Error("Aborted");let[o]=await this.#r(i,{signal:r.signal});o&&r.abort(),a([i,o])};for(let i of t)e.push(this.#W(n,i));let s=await Promise.all(e.map(i=>i.catch(a=>["",!1])));for(let[i,a]of s)if(a)return i;return null}async#z(t,e=!1){let[r,n]=await this.#r(t);return r?t:e?await this.#G(this.aliasIndexes):await this.#J(this.aliasIndexes)}async beamPrep(t,e){let r=await this.#z(t,e);if(!r)throw new Error("File not found!");let n=await this.#_(r);return c.lastChub=n,{...n,location:t}}async beamParse(t,e=""){let r=await t.text(),n=this.parse(r,!0);return{text:r,doc:n,location:e}}async beamMake(t,e){let{req:r}=await this.beamPrep(t,e);return await this.beamParse(r,t)}async beamDo(t,e){let{text:r,doc:n,location:s}=await this.beamParse(t);this.beamRender(n,e,{location:s,text:r})}beamRender(t,e,r={}){this.chubDev&&console.log(t);let n=e||this.chubLocation||"chub",s=this.$(n)||document.body;s.innerHTML=t,u.#t.detail={nodes:s,text:t,...r},u.#t.activate()}async beamSync(t,e,r=!1){let{req:n}=await this.beamPrep(t,r);return async()=>await this.beamDo(n,e)}async beamChub(t,e,r=!1){return await(await this.beamSync(t,e,r))()}constructor(){super();try{this.#Q()}catch{}}#Q(){}},L=new C;try{module.exports=L}catch{}try{c.window.ChubML=L}catch{}export{C as ChubMLMod};
//# sourceMappingURL=cml.mjs.map