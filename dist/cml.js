"use strict";var C=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var $=(o,t)=>{for(var e in t)C(o,e,{get:t[e],enumerable:!0})},N=(o,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of x(t))!T.call(o,n)&&n!==e&&C(o,n,{get:()=>t[n],enumerable:!(r=S(t,n))||r.enumerable});return o};var A=o=>N(C({},"__esModule",{value:!0}),o);var D={};$(D,{ChubMLMod:()=>y});module.exports=A(D);var h=globalThis,b=h.eval;var u=class extends Error{constructor(t,e){super(Array.isArray(t)?t.join(`
`):t),this.name="CowErr"+(e?` (${e})`:"")}toss=(...t)=>console.error(this,...t);throw(){throw this}};var z=require("../global");var p=class o{static CML_Static=o;CML_Static=o;static errorList={eqspl3:new u(["You can't have 3 Equals characters (`=`)!","Try to shorten it please, use `|e`","it is the escaped version of `=`.",,'Use: "meta %name=viewport %content=width|edevice-width;"',"=> `|e` replaced with `=`",'=> "meta %name=viewport %content=width=device-width;"']),scripterror:new u(["Apparently, you made an error loading or executing your script.","Look back and take a gander.",,"Potentially:","=> Check if you loaded the right file.","=> Check if you made a typo.","=> Check if you did not add the directory to the file.","=> Check if you did every thing else right.",,"=> If all else.cry :("])};static DisplayErrors={noBeam:`
  c;
    beam;
      "Beam Failed!
      <br>
      Try to fix the simple Fetch error.
      <br>
      Shouldn't take long.";
    `};static Rexps={quoteExept:/\n(?=(?:(?:[^"]*"){2})*[^"]*$)/gm,colExept:/\n(?=(?:(?:[^:]*:){2})*[^:]*$)/gm,betweenQuote:/"([a-zA-Z\s\S]+)"/gm,betweenCol:/^:([a-zA-Z\S\s]+):/gm,script:/\{\=([a-zA-Z\S\s][^;]+)\=\}/gm,comment:/\/\/(.*)\n{0,1}/gm,lineWithComment:/[^a-zA-Z0-9:-â– \n]+((?:[\t ]{0,})\/\/(?:.*)\n{0,1})/gm,formatspace1:/\n{1,}/gm,formatspace2:/\n[\t \n]{0,}\n/gm};$(t){return document.querySelector(t)}arrMatch(t,e){let r=0,n=[];for(let s=0;s<e.length;s++)t.includes(e[s])&&(r++,n.push(e[s]));return{count:r,list:n}}};var g=class{constructor(t){this.event=t;this.#e=new CustomEvent(t),this.#n()}#t=[];#r=t=>{this.#t.push(t)};#o=t=>this.#t.splice(this.#t.indexOf(t),1);#u=()=>this.#t=[];#s=t=>this.#t.push(t);private=!1;#c=()=>({event:this.event,globals:this.#t,remove:this.#o,clear:this.#u,add:this.#s,_:()=>this.private?null:this,[Symbol.toStringTag]:"CustomEventHandle"});#a=t=>({set:this.#r,get:this.#c});#i=()=>Object.defineProperty(h,this.event,this.#a(this.event));#n(){this.#i()}get detail(){return this.#e.detail}set detail(t){this.makeEvent(this.event,t)}#e;makeEvent(t,e={}){return this.#e=new CustomEvent(t,{detail:e})}activate(){for(let t of this.#t)t(this.#e);dispatchEvent(this.#e)}};var E=()=>{let o=!1;try{b("import.meta"),o=!0}catch{}return o?"ES Module":typeof module<"u"&&module?.exports&&typeof window>"u"?"Node":typeof window<"u"&&typeof window?.document<"u"?"Browser":"Unknown"};var y=class o extends p{static ChubML=o;ChubML=o;static#t=new g("chubstart");static#r=new g("chubinjected");static{h.lastChub||="",h.cbMode||="",h.chubLocation||="",window.onload=()=>{this.#t.detail=this,this.#t.activate()}}#o=t=>({tag:"",id:"",class:"",content:"",data:"",style:"",attr:"",indent:0,[Symbol.unscopables]:{_:t||null}});#u(t){return Reflect.get(t,Symbol.unscopables)}#s=()=>({str:0,tmp:0});#c=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];get doc(){return document}#a(t,e){typeof t=="string"?this.body.innerHTML=t:this.body.appendChild(t)}get body(){return document.body}set body(t){this.#a(t,this.body)}get head(){return document.head}set head(t){this.#a(t,this.head)}get html(){return document.documentElement}get title(){return document.title}set title(t){document.title=t}get chubLocation(){return h.chubLocation}set chubLocation(t){h.chubLocation=t}get chubDev(){return h.chubDev}set chubDev(t){h.chubDev=t}#i(t,e=""){return t||e}#n(t){return t?t+" ":""}s=p;styled={};#e=()=>this.s.Rexps;#m(t){let e=this.#e;return t.replace(e().lineWithComment,"").replace(e().formatspace2,`
`).replace(e().formatspace1,`
`)}#y(t){let e=t.split(/;/),r=[];for(let n of e)r.push({c:n.trim(),i:n.search(/\S/)});return r}#w(t){let e=[],r=[];for(let n of t){let s=n.i,i={c:n.c,i:s,children:[]};for(;r.length>0&&s<=r[r.length-1].i;)r.pop();r.length>0?r[r.length-1].children.push(i):e.push(i),r.push(Object.assign(i))}return e}#C(t){let e=this.#e,r=t[1],n=r.includes("src="),s=r.includes(`"execafter";
`);var i=!0;let a=async l=>{let m=await(await fetch(l)).text();try{let d=document.createElement("script");d.type="text/javascript",d.text=m,document.body.appendChild(d)}catch(d){console.log(d,this.s.errorList.scripterror)}};if(n&&t){let l=r.match(/src="(.*)"/);l&&(a(l[1]),i=!1)}if(t!==null&&i)try{b(r)}catch(l){console.error(l,this.s.errorList.scripterror)}}async#E(t,e){window?.location?.origin&&(e=`${e}`.includes("{{ORIG}}")?e.replace("{{ORIG}}",window.location.origin):e),t.tag=t.tag?t.tag:"fetcherBlock",t.data=`${this.#n(t.data)}data-fetchw="${e}" data-instance="${new Date().getTime()}"`;let n=await(await fetch(await this.findFile([e]))||{text:()=>e}).text();if(t.content=`${n||""}`,window?.location?.origin){let s=this.$(`[${t.data.split(" ").join("][")}]`);s&&(s.innerHTML=t.content.replace(/\n/g,`
</br>
`))}return e}#v(t,e){try{var r=new Function(e).bind(t)(this)}catch(n){return console.error(n,this.s.errorList.scripterror)}this.chubDev&&console.log("AtEval: ",r),r&&this.#h(t,r)}#h(t,e){let r=this.#i(e);t.content+=r,this.chubDev&&console.log("AtPutCont: ",e)}#L(t,e){let r=this.#i(e),n=b(r);if(!n)throw new u("CowErr","No Call: "+r);if(typeof n!="function")throw new u("CowErr","Not a function: "+r);let s=n(t);s&&this.#h(t,s),this.chubDev&&console.log("Call: ",s)}#k(t,e){let r=this.#i(e),n=this.$(r);if(!n)throw new u("CowErr","No Template: "+r);let s=n.innerHTML;t.content+=s,this.chubDev&&console.log("AtFrom: ",s)}#S(t,e){if(typeof e!="string")return;this.chubDev&&console.log("using @: ",`${e}`.slice(1).split(/[=>]/));let r=e.slice(1);function n(i){return r.slice(i+1)}function s(i){return r.startsWith(i)}switch(!0){case s("fetchw"):this.#E(t,n(6));break;case s("eval"):this.#v(t,n(4));break;case s(":"):this.#h(t,n(0));break;case s("call"):this.#L(t,n(4));break;case s("from"):this.#k(t,n(4));break;case s(""):default:console.log("no valid @ found...?",e)}return e}#d(t,e,r,n=1){let s=r.slice(n);t[e]=this.#n(t[e].toString())+s}#x(t,e){this.#d(t,"class",e)}#T(t,e){this.#d(t,"id",e)}#$(t,e){this.#f(t,e,"data",!0)}#N(t,e){this.#f(t,e,"attr",!1)}#f(t,e,r,n){let s=this.attrSyn(e);if(!s)return;let i=s[0].slice(1),a=s[1],l=`${i}="${a}"`;n&&(l=`data-${l}`),t[r]=this.#n(t[r])+l}#A(t,e,r){switch(t[0]){case"#":this.#T(e,t);break;case".":this.#x(e,t);break;case"$":this.#$(e,t);break;case"%":this.#N(e,t);break;case"@":t=this.#S(e,t);break;default:e.tag=this.#n(e.tag)+t}return t}#b=(t,e)=>e.forEach((r,n)=>{r=this.#A(r,t,n)});#p(t,e,r,n=""){let s=this.#e,i="  ",a=t.c,l=a.search(s().betweenQuote),c=a.search(s().betweenCol),m=a.match(s().script),d=this.#o(t),f=this.#o(t);if(m!==null&&this.#C(s().script.exec(a)),l!==-1){let w=a.split(s().betweenCol),k=a.split(s().betweenQuote)[1];if(c==null)f=d;else{var L=w[1]||"";this.#b(f,L.split(" "))}r.str++,f.content=k}else this.#b(f,a.split(" "));return t.o=f,t.i=i.repeat(e),t.children&&t.children.forEach(w=>this.#p(w,e+1,r,n)),[t,r]}#D(t,e=this.#s()){let{o:r}=t,n=!1;if(!r)throw new u("No CIL object found!");switch(r.tag){}return{isTemplate:n}}#R(t,e){for(let r in this.styled)if(this.styled[r]===!0&&this.styled.styles[r]){let n=e?"":`
`;t=t.replace("<head>","<head>"+n+this.styled.styles[r]),this.styled[r]="has"}return t}#I(t,e){return t.includes("head")&&(t=this.#R(t,e)),t}#O(t,e){let r=s=>!!s,n=s=>t+=s;return r(e.class)&&n(` class="${e.class}"`),r(e.id)&&n(` id="${e.id}"`),r(e.style)&&n(` style="${e.style}"`),r(e.data)&&n(` ${e.data}`),r(e.attr)&&n(` ${e.attr}`),t}#P(t,e,r,n,s,i){let a=i?"":`
`;t=a+`${i?"":e.i}<${r.tag}`,t=this.#O(t,r),n>0&&(s=!0);let l=">"+a;return s&&(t+=" /"),t+=l,{html:t,shorter:s}}#F(t,e,r,n){let s=n?"":t.i;switch(t.c[0]){case'"':e+=s+t.c.slice(1,t.c.length-1);break;default:e+=s+this.#g(t,r,n)}return e}#H(t,e,r,n){for(let s of t.children)e=this.#F(s,e,r,n);return e}#q(t,e,r,n,s){let i=s?"":`
`;return t+=i,e||(t+=`${s?"":r.i}</${n.tag}>${i}`),t.includes("<>")&&(t=t.replace("<>","").replace("</>","")),t}#M(t,e,r){let n=r?"":t.i+"  ";return t.o?.content&&(e+=n+t.o.content),e}#g(t,e=this.#s(),r=!1){let n=t.o;if(!n)throw new u("No CIL object found!");let s=!1,i=this.arrMatch(n.tag,this.#c),a=i.count,l=i.list,c="",{isTemplate:m}=this.#D(t,e);return{html:c,shorter:s}=this.#P(c,t,n,a,s,r),c=this.#M(t,c,r),c=this.#H(t,c,e,r),c=this.#q(c,s,t,n,r),c=this.#I(c,r),c}#U(t,e,r=""){let n=this.#s();return[t,n]=this.#p(t,0,n,r),this.#g(t,n,e)}parse(t,e){let r=this.#m(t),n=this.#y(r),s=this.#w(n);return this.#U(s[0],e)}async findFile(t){for(let r of t){try{var e=await fetch(r)}catch(n){console.error(`Error fetching file from '${r}':`,n)}if(e?.ok)return r}return null}ChubRep(t,e="<!DOCTYPE html>"){t=this.parse(t,!0),document.open(),document.write(e+`
`+t),document.close()}injectChub(t){var e=this.parse(t,!0);this.chubDev==!0&&console.log(e);let r=this.chubLocation||"chub",n=this.$(r);n?n.innerHTML=e:r="body",o.#r.detail=n,o.#r.activate()}Router=class{__env__=E();constructor(){switch(this.__env__){case"Node":break;case"Browser":break}}};CHUBfax(t,e=" "){let r=t||"";return r=r.replaceAll("=","|e").replaceAll(";","|col").replaceAll('"',"|qw").replaceAll(e,"|"),r}attrSyn(t){if(`${t}`.match(/=/gm)?.length>1)throw this.s.errorList.eqspl3;return t.replace("="," spcfork.Equals.Token ").replace("\\|"," spcfork.Pipe.Token ").replace(/\|e/gm,"=").replace(/\|col/gm,";").replace(/\|qw/gm,'"').replace(/\|/gm," ").replace(" spcfork.Pipe.Token ","|").split(" spcfork.Equals.Token ")}async CHUBWFetch(t){let e=await fetch(t);if(!e?.ok)throw new Error(`HTTP error! Status: ${e.status}`);let r=await e.text();return this.HTMLToChub(r)}getURLbit(){var t=window.location.href,e=t.split("/"),r=e[e.length-1];return r}CHUBsanitize(t){var e=document.createElement("div");e.innerText=t;var r=e.innerHTML;return r}DupeCollection={};CHUBduper(t="p;"){this.DupeCollection||(this.DupeCollection={}),this.DupeCollection[t]!==void 0?this.DupeCollection[t]+=1:this.DupeCollection[t]=0;let e;if(t.includes(";")){let n=t.split(";");n[0]+=` #${this.DupeCollection[t]}`,e=n.join("")}else e=t+";";let r={editedDupe:e,D:this.DupeCollection,s:()=>JSON.stringify(this.DupeCollection),c:()=>JSON.parse(r.s())};return r}CHUBstrprep(t){return t.replace(/[.*+?^${}()|[\]\\"';:]/g,"\\$&").replace(/[;]/g,"|col")}CHUBunmess(t){let r=t.replace(/\\\"/g,'"').replace(/\\\|col/g,",");return[r,JSON.parse(r)]}MLTextToNodes(t,e="text/html"){return new DOMParser().parseFromString(t,e)}Chubify(t){let e=this.parse(t,!0);return this.MLTextToNodes(e,"text/html")}HTMLToChub=(t,e="")=>{t instanceof Element&&(t=t.outerHTML);let r=this.MLTextToNodes(t,"text/html");return this.getChubML(r.documentElement,"",e)};getChubML=(t,e="",r="")=>{let n="";if(n+=`${e}${t.nodeName.toLowerCase()}`,t.attributes.length>0){let s=Array.from(t.attributes);n=this.#G(s,n)}return t.childNodes.length>0?n=this.#j(n,t,e,r):n+=`;
`,n};#B(t,e){if(!t.textContent)return"";let r=t.textContent.trim();return r!=""?`${e}  "${r}";
`:""}#j(t,e,r,n){t+=`;
`;let s=Array.from(e.childNodes);for(let i of s)switch(i.nodeType){case Node.TEXT_NODE:t+=this.#B(i,r);break;case Node.ELEMENT_NODE:t+=this.getChubML(i,r+"  ",n);break}return t+=`${r}${n}
`,t}#G(t,e){let r=n=>this.CHUBfax(n.value);for(let n of t)switch(n.name.toLowerCase()){case"class":e+=` .${r(n)}`;break;case"id":e+=` #${r(n)}`;default:e+=` %${n.name}=${r(n)}`}return e}aliasIndexes=["beam.lmc","beam.chub","index.lmc","index.chub"];async#l(t,e={}){let r=await fetch(t,{method:"HEAD",...e});return[r.ok,r]}async#_(t){let[e,r]=await this.#l(t);if(!e)throw new Error("File not found!");return{req:await fetch(t),okRes:r}}async#z(t){for(let e of t){let[r,n]=await this.#l(e);if(r)return e}return null}#W=(t,e)=>new Promise(async(r,n)=>{try{await t(e,r)}catch(s){n(s)}});async#Z(t){let e=[],r=new AbortController,n=async(i,a)=>{if(r.signal.aborted)throw new Error("Aborted");let[l]=await this.#l(i,{signal:r.signal});l&&r.abort(),a([i,l])};for(let i of t)e.push(this.#W(n,i));let s=await Promise.all(e.map(i=>i.catch(a=>["",!1])));for(let[i,a]of s)if(a)return i;return null}async#J(t,e=!1){let[r,n]=await this.#l(t);return r?t:e?await this.#z(this.aliasIndexes):await this.#Z(this.aliasIndexes)}async beamPrep(t,e){let r=await this.#J(t,e);if(!r)throw new Error("File not found!");let n=await this.#_(r);return h.lastChub=n,{...n,location:t}}async beamParse(t,e=""){let r=await t.text(),n=this.parse(r,!0);return{text:r,doc:n,location:e}}async beamMake(t,e){let{req:r}=await this.beamPrep(t,e);return await this.beamParse(r,t)}async beamDo(t,e){let{text:r,doc:n,location:s}=await this.beamParse(t);this.beamRender(n,e,{location:s,text:r})}beamRender(t,e,r={}){this.chubDev&&console.log(t);let n=e||this.chubLocation||"chub",s=this.$(n)||document.body;s.innerHTML=t,o.#r.detail={nodes:s,text:t,...r},o.#r.activate()}async beamSync(t,e,r=!1){let{req:n}=await this.beamPrep(t,r);return async()=>await this.beamDo(n,e)}async beamChub(t,e,r=!1){return await(await this.beamSync(t,e,r))()}constructor(){super();try{this.#Q()}catch{}}#Q(){}},v=new y;try{module.exports=v}catch{}try{h.window.ChubML=v}catch{}
//# sourceMappingURL=cml.js.map